# Use the official Node.js 16 image
FROM node:16

# Set the timezone to India Standard Time
ENV TZ=Asia/Kolkata

# Install required dependencies
RUN apt-get update \
    && apt-get install -y wget apt-utils fuse libcurl3-gnutls libgnutls30 cron 


# install blobfuse
RUN apt-get update \
    && apt-get install -y wget apt-utils \
    && wget https://packages.microsoft.com/config/ubuntu/18.04/packages-microsoft-prod.deb \
    && dpkg -i packages-microsoft-prod.deb \
    && apt-get remove -y wget \
    && apt-get update \
    && apt-get install -y --no-install-recommends fuse blobfuse libcurl3-gnutls libgnutls30 
    

# Install dependencies
RUN apt-get update && apt-get install -y ffmpeg
# Install cron
RUN apt-get install -y cron

# Create app directory
WORKDIR /usr/src/app

# Copy package.json and package-lock.json to the working directory
COPY package*.json ./

# Install Node.js dependencies
RUN npm install

# Install PM2 globally
RUN npm install -g pm2

# Bundle app source
COPY . .

# Expose RTMP and HTTP ports
EXPOSE 1935 
EXPOSE 8000
EXPOSE 443

# Run blobfuse to mount Azure Blob Storage
CMD service cron start &&  /usr/src/app/run.sh

